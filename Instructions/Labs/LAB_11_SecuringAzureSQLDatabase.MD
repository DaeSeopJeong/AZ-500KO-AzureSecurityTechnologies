---
lab:
    title: '11 - Azure SQL Database 보안'
    module: '모듈 03 - 데이터 및 애플리케이션 보안'
---

# 랩 11: Azure SQL Database 보호
# 학생 랩 매뉴얼

## 랩 시나리오

Azure SQL 데이터베이스에 대한 보안 기능을 검토해야 합니다. 특히, 다음과 같은 기능에 관심이 있습니다.

- SQL 주입 및 데이터 반출과 같은 공격으로부터 보호합니다. 
- 데이터베이스 정보를 검색하고 기밀과 같은 범주로 분류하는 기능. 
- 데이터베이스 서버, 데이터베이스 쿼리 및 로그 이벤트를 감사하는 기능. 

> 이 랩의 모든 리소스에 대해, **미국 동부** 지역을 사용하고 있습니다. 강사에게 이 영역이 수업에 사용할 영역인지 확인합니다. 

## 랩 목표

이 랩에서는 다음의 연습을 완료합니다:

- 연습 1: SQL Database 보안 기능 구현

## 랩 파일:

- **\\Allfiles\\Labs\\11\\azuredeploy.json**

### 연습 1: SQL Database 보안 기능 구현

### 예상 시간: 30분

이 연습에서는 다음 작업을 수행합니다.

- 작업 1: Azure SQL Database 배포
- 작업 2: 고급 데이터 보호 구성
- 작업 3: 데이터 분류 구성
- 작업 4: 감사 구성

#### 작업 1: Azure SQL Database 배포

이 작업에서는 템플릿을 사용하여 랩 인프라를 배포합니다. 

1. Azure Portal **`https://portal.azure.com/`**에 로그인합니다.

    >**참고**: 이 랩에 사용 중인 Azure 구독에 Owner 또는 Contributor 역할이 있는 계정을 사용하여 Azure Portal에 로그인합니다.

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에 **사용자 지정 템플릿 배포**를 입력하고 **Enter**키를 누릅니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 사용자 고유의 탬플릿 빌드** 옵션을 클릭합니다.

1. **템플릿 편집** 블레이드에서 **로드 파일**을 클릭하고 **\\Allfiles\\Labs\\11\\azuredeploy.json** 파일을 찾아 **열기**를 클릭합니다.

    >**참고**: 템플릿의 콘텐츠를 검토하고 Azure SQL 데이터베이스에 배포된 것을 확인합니다.

1. **템플릿 편집** 블레이드에서 **저장**을 클릭합니다.

1. **사용자 지정 배포** 블레이드에서 다음 설정이 구성되었는지 확인합니다 (다른 설정은 기본값으로 유지).

   |설정|값|
   |---|---|
   |구독|이 랩에서 사용할 Azure 구독의 이름|
   |리소스 그룹| **새로 만들기**를 클릭하고 **AZ500LAB11** 이름을 입력합니다.|
   |위치| **(미국) 미국 동부** |

1. **검토 + 만들기** 그리고 **만들기**를 차례로 클릭합니다.

    >**참고**: 배포가 완료될 때까지 기다립니다. 

#### 작업 2: 고급 데이터 보호 구성

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에 **리소스 그룹**을 입력하고 **Enter**키를 누릅니다.

1. **리소스 그룹** 블레이드의 리소스 그룹 목록에서 **AZ500LAB11** 항목을 클릭합니다.

1. **AZ500LAB11-RG** 블레이드에서 새로 만들어진 SQL Server를 나타내는 항목을 클릭합니다.

1. 서버 블레이드의 **보안** 섹션에서 **Advanced Data Security**를 클릭합니다.

1. **Advanced Data Security** 스위치를 **켜기**로 설정합니다.

    >**참고**: 가격 책정 및 평가판 기간에 대한 정보를 검토합니다.

1. **Advanced Threat Protection 유형**을 클릭합니다. 

1. **Advanced Threat Protection 유형** 블레이드에서 위협 유형 목록을 검토하고 **확인**을 클릭한 다음, **Advanced Data Security** 창으로 돌아가서 **저장**을 클릭합니다.

1. **취약성 평가 설정** 섹션에서 **스토리지 계정**을 클릭합니다.

1. **스토리지 계정 만들기** 블레이드에서 **이름** 상자에  3~24개의 소문자와 숫자로 구성된 전역적으로 고유한 이름을 입력하고 **확인**을 클릭한 다음, **Advanced Data Security** 창으로 돌아가서 **저장**을 클릭합니다.

    >**참고**: 잘못된 스토리지 컨테이너 경로에 대한 오류 메시지가 표시되는 경우 스토리지 계정이 아직 프로비전되지 않았을 수 있습니다. 몇 분 간 기다렸다가 **스토리지 계정**을 클릭한 다음, **스토리지 계정 선택** 블레이드에서 새로 만든 스토리지 계정을 선택하고 다시 **Advanced Data Security** 창에서 **저장**을 클릭합니다.

#### 작업 3: 데이터 분류 구성

이 작업에서는 GPDR 및 데이터 보호 준수를 위해 SQL Database에서 정보를 검색하고 분류합니다.

1. **설정** 섹션의 서버 블레이드에서 **SQL Databases**를 클릭합니다.

1. 데이터베이스 목록에서 **AZ500LabDb** 항목을 선택합니다. 

1. **보안** 섹션의 **AZ500LabDb** SQL 데이터베이스 블레이드에서 **고급 데이터 보안**을 클릭합니다.

1. 고급 데이터 보안 블레이드에서 **데이터 검색 및 분류** 타일을 클릭합니다.

1. **데이터 검색 및 분류** 블레이드에서 **분류** 탭을 클릭합니다.

    >**참고**: 분류 엔진은 잠재적으로 중요한 데이터가 포함된 열의 데이터베이스를 검색하고 권장되는 열 분류 목록을 제공합니다.

1. 블레이드 상단의 파란색 막대에 **분류 권장 사항이 있는 15개의 열을 찾았습니다**라고 표시되는 문자 메시지를 클릭합니다.

1. 나열된 열과 권장 민감도 레이블을 검토합니다. 

1. **모두 선택** 확인란을 활성화한 다음, **선택한 권장 사항 수락**을 클릭합니다.

    >**참고**: 또는 특정 열만 선택하고 다른 열을 해제할 수 있습니다. 

    >**참고**: 정보 유형 및 민감도 레이블을 변경할 수 있습니다. 

1. 검토가 완료되면 **저장**을 클릭합니다. 

    >**참고**: 이렇게 하면 분류를 완료하고 데이터베이스 열을 새 분류 메타데이터로 영구적으로 레이블을 지정할 수 있습니다. 

1. Advanced Data Security 블레이드로 돌아가면 **데이터 검색 및 분류** 타일이 최신 분류 정보를 처리하도록 업데이트되었습니다. 

#### 작업 4: 감사 구성 

이 작업에서는 먼저 서버 수준 감사를 구성한 다음 데이터베이스 수준 감사를 구성합니다. 

1. Azure Portal에서 다시 SQL Server 블레이드로 이동합니다.

1. SQL Server 블레이드의 **보안** 섹션에서 **감사**를 클릭합니다.

    >**참고**: 서버 수준 감사입니다. 기본 감사 설정에는 데이터베이스에 대해 실행되는 모든 쿼리 및 저장 프로시저 그리고 성공 및 실패한 로그인이 포함됩니다.

1. 감사를 활성화하려면 **감사** 스위치를 **켜기**로 설정합니다. 

1. **스토리지** 확인란을 선택하고 **구성**을 클릭합니다. 

1. **스토리지 설정** 블레이드에서 **스토리지 계정**을 클릭합니다.

1. **스토리지 계정 만들기** 블레이드의 **이름** 상자에 3~24자의 소문자와 숫자로 구성된 전역에서 고유한 이름을 입력하고 **확인**을 클릭합니다. 

1. **스토리지 설정** 블레이드로 돌아가서 **보존(일)**을 **5**일로 설정하고 **확인**을 클릭합니다. 

1. 감사 블레이드로 돌아가서 **저장**을 클릭하여 감사 설정을 저장합니다. 

    >**참고**: 잘못된 스토리지 컨테이너 경로에 대한 오류 메시지가 표시되는 경우 스토리지 계정이 아직 프로비전되지 않았을 수 있습니다. 몇 분 간 기다렸다가 **스토리지 계정**을 클릭하고 **스토리지 계정 선택** 블레이드에서 새로 만든 스토리지 계정을 선택하고 감사 블레이드로 돌아가서 **저장**을 클릭합니다.

1. **설정** 섹션의 서버 블레이드에서 **SQL Databases**를 클릭합니다.

1. 데이터베이스 목록에서 **AZ500LabDb** 항목을 선택합니다. 

1. **AZ500LabDb** SQL Database 블레이드의 **보안** 섹션에서 **감사**를 클릭합니다. 

    >**참고**: 데이터베이스 수준 감사입니다. 서버 수준 감사가 이미 활성화되었습니다. 
  
    >**참고**: 감사는 Azure Storage 계정, Log Analytics 작업 공간 또는 이벤트 허브에 기록할 수 있습니다. 이러한 옵션의 모든 조합을 구성할 수 있습니다.

    >**참고**: 스토리지 기반 감사가 서버에서 활성화되는 경우 데이터베이스 설정에 관계없이 항상 데이터베이스에 적용됩니다.

1. **감사 로그 보기**를 클릭합니다.

1. **감사 기록** 블레이드에서 서버 감사와 데이터베이스 감사 간에 전환할 수 있습니다. 

    >**참고**: 이 SQL Server 및 Database가 최근에 만들어졌기 때문에 이 시점에서는 어떠한 이벤트도 사용할 수 없을 것 같습니다. 

> 결과: SQL Server 및 Database를 만들고 데이터 분류 및 감사를 구성했습니다. 


**리소스 정리**

> 더 이상 사용하지 않는 새로 만든 Azure 리소스를 제거해야 합니다. 사용하지 않는 리소스를 제거하면 예기치 않은 비용이 발생하지 않습니다. 

1. Azure Portal에서 Azure Portal의 오른쪽 상단의 첫 번째 아이콘을 클릭하여 Cloud Shell을 엽니다. 메시지가 표시되면 **PowerShell**, 그리고 **스토리지 만들기**를 클릭합니다.

1. Cloud Shell 창의 왼쪽 위 모서리에 있는 드롭다운 메뉴에서 **PowerShell**이 선택되었는지 확인합니다.

1. Cloud Shell 창 내의 PowerShell 세션에서 다음을 실행하여 이 랩에서 만든 리소스 그룹을 제거합니다.
  
    ```powershell
    Remove-AzResourceGroup -Name "AZ500LAB11" -Force -AsJob
    ```
1. **Cloud Shell** 창을 닫습니다. 
