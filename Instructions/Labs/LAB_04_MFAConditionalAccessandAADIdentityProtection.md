---
lab:
    title: '04 - MFA, 조건부 액세스 및 AAD ID 보호'
    module: '모듈 01 - ID 및 액세스 관리'
---

# 랩 04: MFA, 조건부 액세스 및 AAD ID 보호
# 학생 랩 매뉴얼

## 랩 시나리오

Azure AD(Azure Active Directory) 인증을 향상하는 기능의 개념 증명을 만들라는 메시지가 표시됩니다. 특히 다음을 평가하려고 합니다.

- Azure AD 다단계 인증
- Azure AD 조건부 액세스
- Azure AD ID 보호

> 이 랩의 모든 리소스에 대해, **미국 동부** 지역을 사용하고 있습니다. 강사에게 이 영역이 수업에 사용할 영역인지 확인합니다. 

## 랩 목표

이 랩에서는 다음의 연습을 완료합니다.

- 연습 0: Azure Resource Manager 템플릿을 사용하여 Azure VM 배포
- 연습 1: Azure MFA 구현
- 연습 2: Azure AD 조건부 액세스 정책 구현 
- 연습 3: Azure AD ID 보호 구현

## 랩 파일:

- **\\Allfiles\\Labs\\04\\az-500-04_azuredeploy.json**
- **\\Allfiles\\Labs\\04\\az-500-04_azuredeploy.parameters.json** 

### 연습 0: Azure Resource Manager 템플릿을 사용하여 Azure VM 배포

### 예상 시간: 10분

이 연습에서는 다음 작업을 수행합니다.

- 작업 1: Azure Resource Manager 템플릿을 사용하여 Azure VM을 배포합니다.

#### 작업 1: Azure Resource Manager 템플릿을 사용하여 Azure VM 배포

이 작업에서는 ARM 템플릿을 사용하여 가상 머신을 생성합니다. 이 가상 머신은 이 랩의 마지막 연습에 사용됩니다. 

1. Azure Portal **`https://portal.azure.com/`** 에 로그인합니다.

    >**참고**: 이 랩에서 사용하는 Azure 구독의 Owner 또는 Contributor 역할과 해당 구독과 연결된 Azure AD 테넌트의 전역 관리자 역할을 가진 계정을 사용하여 Azure Portal에 로그인합니다.

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에 **사용자 지정 템플릿 배포**를 입력하고 **Enter**키를 누릅니다.

1. **사용자 지정 배포** 블레이드에서 **편집기에서 사용자 고유의 탬플릿 빌드** 옵션을 클릭합니다.

1. **템플릿 편집** 블레이드에서 **로드 파일**을 클릭하고 **\\Allfiles\\Labs\\04\\az-500-04_azuredeploy.json** 파일을 찾아 **열기**를 클릭합니다.

    >**참고**: 템플릿의 내용을 검토하고 Windows Server 2019 Datacenter를 호스팅하는 Azure VM를 배포함을 참고합니다.

1. **템플릿 편집** 블레이드에서 **저장**을 클릭합니다.

1. **사용자 지정 배포** 블레이드로 돌아가서 **매개 변수 편집**을 클릭합니다.

1. **매개 변수 편집** 블레이드에서 **파일 로드**를 클릭하고 **\\Allfiles\\Labs\\04\\az-500-04_azuredeploy.parameters.json** 파일을 찾아 **열기**를 클릭합니다.

    >**참고**: adminUsername 및 adminPassword 값을 지적하는 매개 변수 파일의 내용을 검토합니다.

1. **매개 변수 편집** 블레이드에서 **저장**을 클릭합니다.

1. **사용자 지정 배포** 블레이드에서 다음 설정이 구성되었는지 확인합니다 (다른 설정은 기본값으로 유지).

   |설정|값|
   |---|---|
   |구독|이 랩에서 사용할 Azure 구독의 이름|
   |리소스 그룹| **새로 만들기**를 선택하고 이름 **AZ500LAB04**를 입력합니다.|
   |위치| **(미국) 미국 동부** |
   |VM 크기| **Standard_D2s_v3** |
   |VM 이름| **az500-04-vm1** |
   |관리자 사용자 이름| **학생** |
   |관리자 암호| **Pa55w.rd1234** |
   |가상 네트워크 이름| **az500-04-vnet1** |

    >**참고**: Azure VM을 프로비전할 수 있는 Azure 지역을 확인하려면 [**https://azure.microsoft.com/ko-kr/regions/offers/**](https://azure.microsoft.com/ko-kr/regions/offers/)을 참고하세요.

1. **위에 명시된 이용 약관에 동의합니다.** 확인란을 선택하고 **구매**를 클릭합니다.

    >**참고**: 배포가 완료될 때까지 기다리지 말고 다음 연습을 진행하세요. 이 랩의 마지막 연습에서 이 배포에 포함된 가상 머신을 사용합니다.

> 결과: 이 랩의 마지막 연습에서 사용할 Azure VM **az500-04-vm1**의 템플릿 배포를 시작했습니다.


### 연습 1: Azure MFA 구현

### 예상 시간: 30분

이 연습에서는 다음 작업을 수행합니다.

- 작업 1: 새 Azure AD 테넌트를 만듭니다.
- 작업 2: Azure AD Premium v2 평가판 활성화.
- 작업 3: Azure AD 사용자 및 그룹을 만듭니다.
- 작업 4: Azure AD Premium v2 라이선스를 Azure AD 사용자에게 할당합니다.
- 작업 5: Azure MFA 설정을 구성합니다.
- 작업 6: MFA 구성 유효성 검사

#### 작업 1: 새 Azure AD 테넌트를 만듭니다.

이 작업에서는 새 Azure AD 테넌트를 만듭니다. 

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에서 **Azure Active Directory**를 입력하고 **Enter** 키를 누릅니다.

1. 현재 Azure AD 테넌트의 **개요**를 표시하는 블레이드에서 **+ 테넌트 만들기**를 클릭합니다.

1. **디렉터리 만들기** 블레이드의 **기본** 탭에서 **Azure Active Directory** 옵션을 선택하고 **다음:**을 클릭합니다.** 구성 >**.

1. **디렉터리 만들기** 블레이드의 **구성** 탭에서 다음 설정을 구성합니다.

   |설정|값|
   |---|---|
   |조직 이름| **AdatumLab500-04** |
   |초기 도메인 이름|문자와 숫자의 조합으로 구성된 고유한 이름|
   |국가 또는 지역| **미국** |

    >**참고**: 초기 도메인 이름을 기록합니다. 이 랩의 후반부에서 필요할 것입니다.

1. **검토 + 만들기**를 클릭하고 **만들기**를 클릭합니다.

    >**참고**: 새 테넌트가 생성될 때까지 기다립니다. **알림** 아이콘을 사용하여 배포 상태를 모니터링합니다. 


#### 작업 2: Azure AD Premium v2 평가판 활성화

이 작업에서는 Azure AD Premium P2 무료 평가판에 등록합니다. 

1. Azure Portal의 도구 모음에서 Cloud Shell 셸 아이콘 오른쪽에 있는 **디렉터리 + 구독** 아이콘을 클릭합니다. 

1. **디렉터리 + 구독** 블레이드에서 새로 만든 테넌트인 **AdatumLab500-04**를 클릭합니다.

    >**참고**: **AdatumLab500-04** 항목이 **디렉터리 + 구독** 필터 목록에 나타나지 않으면 브라우저 창을 새로 고쳐야 할 수 있습니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **라이선스**를 클릭합니다.

1. **라이선스**에서 **\| 개요** 블레이드의 **관리** 섹션에서, **모든 제품**을 클릭 한 다음 **+ 사용/구매**를 클릭합니다.

1. **활성화** 블레이드의 Azure AD Premium P2 섹션에서 **무료 평가판**을 클릭한 다음 **활성화**를 클릭합니다.


#### 작업 3: Azure AD 사용자 및 그룹을 만듭니다.

이 작업에서는 다음 세 사용자를 만듭니다. aaduser1(전역 관리자), aaduser2(사용자), aaduser3(사용자). 이후 작업에는 각 사용자의 주체 이름과 암호가 필요합니다. 

1. **AdatumLab500-04** Azure Active Directory 블레이드로 다시 이동하여 **관리** 섹션에서 **사용자**를 클릭합니다.

1. **사용자 \| 모든 사용자** 블레이드에서 **+ 새 사용자**를 클릭합니다. 

1. **새 사용자** 블레이드에서 **사용자 만들기** 옵션이 선택되었는지 확인하고 다음 설정을 지정합니다(다른 모든 설정을 기본값으로 남겨 둡니다).

   |설정|값|
   |---|---|
   |사용자 이름| **aaduser1** |
   |이름| **aaduser1** |
   |암호| **암호 자동 생성** 옵션이 선택되었는지 확인하고 **암호 표시**를 클릭합니다|
   |그룹| **0개 그룹 선택됨** |
   |역할| **사용자**를 클릭하고, **전역 관리자**를 클릭한 다음 **Select**를 클릭합니다.|
   |사용 위치| **미국** |  

    >**참고**: 전체 사용자 이름을 기록합니다. 도메인 이름이 표시된 드롭다운 목록의 오른쪽에 있는 **클립보드에 복사** 단추를 클릭하여 해당 값을 복사할 수 있습니다. 

    >**참고**: 사용자의 암호를 기록합니다. 이 랩에서 나중에 필요합니다. 

1. 다시 **사용자**로 돌아갑니다 **\| 모든 사용자** 블레이드에서 **+ 새 사용자**를 클릭합니다. 

1. **새 사용자** 블레이드에서 **사용자 만들기** 옵션이 선택되었는지 확인하고 다음 설정을 지정합니다(다른 모든 설정을 기본값으로 남겨 둡니다).

   |설정|값|
   |---|---|
   |사용자 이름| **aaduser2** |
   |이름| **aaduser2** |
   |암호| **암호 자동 생성** 옵션이 선택되었는지 확인하고 **암호 표시**를 클릭합니다|
   |그룹| **0개 그룹 선택됨** |
   |역할| **사용자** |
   |사용 위치| **미국** |  

    >**참고**: 전체 사용자 이름과 암호를 기록합니다.

1. 다시 **사용자**로 돌아갑니다 **\| 모든 사용자** 블레이드에서 **+ 새 사용자**를 클릭합니다. 

1. **새 사용자**를 클릭하고 새 사용자 구성 설정을 완료한 다음 **만들기**를 클릭합니다.

   |설정|값|
   |---|---|
   |사용자 이름| **aaduser3** |
   |이름| **aaduser3** |
   |암호| **암호 자동 생성** 옵션이 선택되었는지 확인하고 **암호 표시**를 클릭합니다|
   |그룹| **0개 그룹 선택됨** |
   |역할| **사용자** |
   |사용 위치| **미국** |  

    >**참고**: 전체 사용자 이름과 암호를 기록합니다.

1. **새 사용자** 블레이드에서 **만들기**를 클릭합니다.

    >**참고**: 이 시점에서 **사용자**페이지에 새 사용자가 세 명 있어야 합니다. 
	
#### 작업 4: Azure AD Premium v2 라이선스를 Azure AD 사용자에게 할당

이 작업에서는 각 사용자를 Azure Active Directory Premium P2 라이선스에 할당합니다.

1. **사용자 \| 모든 사용자** 블레이드에서 사용자 계정을 나타내는 항목을 클릭합니다. 

1. 사용자 계정의 속성을 표시하는 블레이드에서 **편집**을 클릭합니다. 

1. **설정** 섹션의 **사용 위치** 드롭다운 목록에서 **미국** 항목을 선택하고 **저장**을 클릭합니다.

1. **AdatumLab500-04** Azure Active Directory 블레이드로 다시 이동하여 **관리** 섹션에서 **라이선스**를 클릭합니다.

1. **라이선스**에서 **\| 개요** 블레이드에서 **모든 제품**을 클릭한 후 **Azure Active Directory Premium P2** 확인란을 선택하고 **+ 할당**을 클릭합니다.

1. **라이선스 할당** 블레이드에서 **사용자 및 그룹**을 클릭합니다.

1. **사용자 및 그룹** 블레이드에서 **aaduser1**, **aaduser2**, **aaduser3** 및 사용자 계정을 선택하고 **선택**을 클릭합니다.

1. **라이선스 할당** 블레이드로 돌아가서 **할당 옵션**을 클릭하고 모든 옵션이 활성화되어 있는지 확인하고 **확인**을 클릭합니다.

1. 다시 **라이선스 할당** 블레이드에서 **할당**을 클릭합니다.

1. Azure Portal에서 로그아웃하고 동일한 계정을 사용하여 다시 로그인합니다. 라이선스 할당이 적용되기 위해서는 이 단계가 필요합니다.

    >**참고**: 이 시점에서 이 랩에서 사용할 모든 사용자 계정에 Azure Active Directory Premium P2 라이선스를 할당했습니다. 로그아웃한 다음 다시 로그인하십시오. 

#### 작업 5: Azure MFA 설정을 구성합니다.

이 작업에서는 MFA를 구성하고 aaduser1에 대한 MFA를 활성화합니다. 

1. Azure Portal에서 다시 **AdatumLab500-04** Azure Active Directory 테넌트 블레이드로 이동합니다.

    >**참고**: AdatumLab500-04 Azure AD 테넌트를 사용하고 있는지 확인합니다.

1. **AdatumLab500-04** Azure Active Directory 테넌트 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **관리** 섹션에서 **MFA**를 클릭합니다.

1. **Multi-Factor Authentication \| 시작하기** 블레이드에서 **추가 클라우드 기반 MFA 설정** 링크를 클릭합니다. 

    >**참고**: 그러면 **다단계 인증** 페이지가 표시되는 새 브라우저 탭이 열립니다.

1. **다단계 인증** 페이지에서 **서비스 설정** 탭을 클릭합니다. **확인 옵션**을 검토합니다. **휴대폰에 문자 메시지 전송**, **모바일 앱을 통한 알림**, **모바일 앱 또는 하드웨어 토큰의 확인 코드**가 활성화됩니다. **저장**을 클릭한 후 **닫기**를 클릭합니다.

1. **사용자** 탭으로 전환하고 **aaduser1** 항목을 클릭한 다음 **사용** 링크를 클릭하고 메시지가 표시되면 **다단계 인증 사용**을 클릭합니다.

1. **aaduser1**에 대한 **Multi-Factor Auth 상태** 열이 이제 **활성화**되었습니다.

1. **aaduser1**을 클릭하고 이 시점에서 **적용된** 옵션도 있음을 알 수 있습니다.  

    >**참고**: 사용자 상태를 사용됨에서 적용됨으로 변경하면 Azure MFA를 지원하지 않는 레거시 Azure AD 통합 앱에만 영향을 미치며 상태가 적용됨으로 변경된 후에는 앱 암호를 사용해야 합니다.

1. **aaduser1** 항목을 선택한 경우 **사용자 설정 관리**를 클릭하고 사용 가능한 옵션을 검토합니다. 

   - 선택한 사용자가 연락 방법을 다시 제공하도록 요구합니다.

   - 선택한 사용자가 생성한 모든 기존 앱 암호를 삭제합니다.

   - 기억된 모든 디바이스에서 다단계 인증을 복원합니다.

1. **취소**를 클릭하고 **다단계 인증**이 표시된 브라우저 탭으로 다시 전환합니다. \| Azure Portal의 **시작** 블레이드.

1. **설정** 섹션에서 **사기 행위 경고**를 클릭합니다.

1. **Multi-Factor Authentication \| 사기 행위 경고** 블레이드에서 다음 설정을 구성합니다.

   |설정|값|
   |---|---|
   |사용자가 사기 행위 경고를 제출할 수 있도록 허용| **사용** |
   |사기를 신고하는 사용자를 자동으로 차단| **사용** |
   |첫 인사말 중 사기 행위를 보고할 코드| **0** |

1. **저장**을 클릭합니다

    >**참고**: 이 시점에서 aaduser1 및 사기 행위 경고 설정에 대한 MFA를 활성화했습니다. 

#### 작업 6: MFA 구성 유효성 검사

이 작업에서는 aaduser1 사용자 계정의 로그인을 테스트하여 MFA 구성의 유효성을 검사합니다. 

1. InPrivate 브라우저 창을 엽니다.

1. Azure Portal로 이동하고 **aaduser1** 사용자 계정을 사용하여 로그인 합니다. 

    >**참고**: 로그인하려면 이 랩의 앞에서 기록한 AzureAD 테넌트 DNS 도메인 이름을 포함하여 **aaduser1** 사용자 계정의 정규화된 이름을 제공해야 합니다. 이 사용자 이름은 aaduser1@`<your_tenant_name>`.onmicrosoft.com 형식이며, `<your_tenant_name>`은 고유한 Azure AD 테넌트 이름을 나타내는 자리 표시자입니다. 

1. 메시지가 표시되면 **자세한 정보 필요** 대화 상자에서 **다음**을 클릭합니다.

    >**참고**: 브라우저 세션은 **추가 보안 인증** 페이지로 리디렉션됩니다.

1. **1단계: 문의할 방법 알아보기** 섹션에서 다음 옵션 중 하나 이상을 설정해야 합니다.

   - **인증 휴대폰**

   - **모바일 앱**

1. **인증 전화** 항목이 드롭다운 리스트에 나타나고 **문자 메시지로 내게 코드 보내기** 옵션이 선택되었는지 확인합니다. 

1. **1단계: 어떻게 연락해야 하나요?** 드롭다운 리스트에서 국가 또는 지역을 선택하고 빈 텍스트 상자에 휴대폰 번호를 제공하고 **다음**을 클릭합니다.

1. 전화번호를 제공하고, **다음**을 클릭하고, 텍스트 상자에 휴대 전화의 문자 메시지에서 받은 코드를 입력하고 **확인**을 클릭합니다.

1. **추가 보안 인증** 페이지에서 **3 단계: 기존 애플리케이션을 계속 사용하기**에 제공된 지침을 검토한 다음 **완료**를 클릭합니다.

1. 메시지가 표시되면 암호를 변경합니다. 새 암호를 기록해 두어야 합니다.

1. Azure Portal에 성공적으로 로그인했는지 확인합니다.

1. **aaduser1**로 로그아웃하고 InPrivate 브라우저 창을 닫습니다.

> 결과: 새 AD 테넌트를 만들고, AD 사용자를 구성하고, MFA를 구성하고, 사용자용 MFA 환경을 테스트했습니다. 


### 연습 2: Azure AD 조건부 액세스 정책 구현 

### 예상 시간: 15분

이 연습에서는 다음 작업을 수행합니다. 

- 작업 1: 조건부 액세스 정책을 구성합니다.
- 작업 2: 조건부 액세스 정책을 테스트합니다.

#### 작업 1 - 조건부 액세스 정책을 구성합니다. 

이 작업에서는 조건부 액세스 정책 설정을 검토하고, Azure Portal에 로그인할 때 MFA를 요구하는 정책을 만듭니다. 

1. Azure Portal에서 다시 **AdatumLab500-04** Azure Active Directory 테넌트 블레이드로 이동합니다.

    >**참고**: **AdatumLab500-04** Azure AD 테넌트에 로그인되어 있는지 확인합니다. **디렉터리 + 구독** 필터를 사용하여 Azure AD 테넌트 간에 전환할 수 있습니다. Azure AD 테넌트에서 전역 관리자 역할을 하는 사용자로 로그인되었는지 확인합니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **보호** 섹션에서 **조건부 액세스**를 클릭합니다.

1. **조건부 액세스**에서 **\| 정책** 블레이드에서 **+ 새 정책**을 클릭합니다. 

1. **신규** 블레이드에서 다음 설정을 구성합니다.

   - **이름** 텍스트 상자에 **AZ500Policy1**을 입력합니다.
	
   - **사용자 및 그룹**을 클릭한 후 **사용자 및 그룹** 확인란을 선택하고 **선택** 블레이드에서 **aaduser2**를 클릭한 후 **선택**을 클릭합니다.
	
   - **클라우드 앱 또는 작업**을 클릭한 후 **앱 선택**을 클릭하고 **선택** 블레이드에서 **Microsoft Azure 관리**를 클릭한 후 **선택**을 클릭합니다. 

    >**참고**: 이 정책이 Azure Portal에 대한 액세스에 영향을 미친다는 경고를 검토합니다.
	
   - **조건** 클릭 후 **로그인 위험**을 클릭하고 **로그인 위험** 블레이드에서 위험 수준을 검토하지만 변경하지 않고 **로그인 위험** 블레이드를 닫습니다.
	
   - **디바이스 플랫폼**을 클릭하고 포함할 수 있는 디바이스 플랫폼을 검토하고 **완료**를 클릭합니다.
	
   - **위치** 클릭 후 위치 옵션을 검토하되 변경하지는 않습니다.
	
   - **액세스 컨트롤** 섹션의 **권한 부여**를 클릭 후 **권한 부여** 블레이드에서 **다단계 인증 필요** 확인란을 선택하고 **선택**을 클릭합니다
	
   - **정책 사용**을 **켜기**로 설정합니다.

1. **새** 블레이드에서 **만들기**를 클릭합니다. 

    >**참고**: "조건부 액세스 정책을 사용하도록 설정하려면 보안 기본값을 비활성화해야 합니다"라는 오류 메시지를 받는 경우, **AdatumLab500-04** Azure Active Directory 테넌트 블레이드로 다시 이동하여 **관리** 섹션에서 **속성**을 클릭한 다음 블레이드 하단의 **보안 기본값 관리**를 클릭하고 **보안 기본값 사용** 블레이드에서 **아니오**를 클릭한 다음 **저장**을 클릭합니다.

    >**참고**: 이 시점에서 MFA가 Azure Portal에 로그인해야 하는 조건부 액세스 정책이 있습니다. 

#### 작업 2 - 조건부 액세스 정책을 테스트합니다.

이 작업에서는 Azure Portal에서 **aaduser2**로 로그인하고 MFA가 필요한지 확인합니다. 또한 다음 연습을 계속하기 전에 정책을 삭제합니다. 

1. InPrivate Microsoft Edge 창을 엽니다.

1. 새 브라우저 창에서 Azure Portal로 이동하고 **aaduser2** 사용자 계정을 사용하여 로그인합니다.

1. 메시지가 표시되면 **자세한 정보 필요** 대화 상자에서 **다음**을 클릭합니다.

    >**참고**: 브라우저 섹션이 **추가 보안 인증** 페이지로 리디렉션됩니다.

1. **1단계: 문의할 방법 알아보기** 섹션에서 다음 옵션 중 하나 이상을 설정해야 합니다.

   - **인증 전화**

   - **모바일 앱**

1. **인증 전화** 항목이 드롭다운 리스트에 나타나고 **문자 메시지로 내게 코드 보내기** 옵션이 선택되었는지 확인합니다. 

1. **1단계: 어떻게 연락해야 하나요?** 드롭다운 리스트에서 국가 또는 지역을 선택하고 빈 텍스트 상자에 휴대폰 번호를 제공하고 **다음**을 클릭합니다.

1. 전화번호를 제공하고, **다음**을 클릭하고, 텍스트 상자에 휴대 전화의 문자 메시지에서 받은 코드를 입력하고 **확인**을 클릭합니다.

1. **추가 보안 인증** 페이지에서 **3 단계: 기존 애플리케이션을 계속 사용하기**에 제공된 지침을 검토한 다음 **완료**를 클릭합니다.

1. 메시지가 표시되면 암호를 변경합니다. 새 암호를 기록해 두어야 합니다.

1. Azure Portal에 성공적으로 로그인했는지 확인합니다.

1. **aaduser2**로 로그아웃하고 InPrivate 브라우저 창을 닫습니다.

    >**참고**: 이제 새로 만든 조건부 액세스 정책이 aaduser2가 Azure Portal에 로그인할 때 MFA를 적용한다는 것을 확인했습니다.

1. 다시 Azure Portal을 표시하는 브라우저 창에서 **AdatumLab500-04** Azure Active Directory 테넌트 블레이드로 다시 이동합니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **보호** 섹션에서 **조건부 액세스**를 클릭합니다.

1. **조건부 액세스**에서 **\| 정책** 블레이드에서 **AZ500Policy1** 옆의 줄임표를 클릭하고 **삭제** 클릭 후 확인하라는 메시지가 표시되면 **예**를 클릭합니다.

    >**참고**: 결과: 이 연습에서는 사용자가 Azure Portal에 서명할 때 MFA를 요구하는 조건부 액세스 정책을 구현합니다. 

>결과: Azure AD 조건부 액세스를 구성하고 테스트했습니다.

### 연습 3: Azure AD ID 보호 구현

### 예상 시간: 30분

이 연습에서는 다음 작업을 수행합니다. 

- 작업 1: Azure Portal에서 Azure AD ID 보호 옵션 보기
- 작업 2: 사용자 위험 정책 구성
- 작업 3: 로그인 위험 정책 구성
- 작업 4: Azure AD ID 보호 정책에 대한 위험 이벤트 시뮬레이션 
- 작업 5: Azure AD ID 보호 보고 검토

#### 작업 1: Azure AD ID 보호 사용

이 작업에서는 Azure Portal의 Azure AD ID 보호 옵션을 봅니다. 

1. 필요하면 Azure Portal (**`https://portal.azure.com/`**) 에 로그인합니다.

    >**참고**: **AdatumLab500-04** Azure AD 테넌트에 로그인되어 있는지 확인합니다. **디렉터리 + 구독** 필터를 사용하여 Azure AD 테넌트 간에 전환할 수 있습니다. Azure AD 테넌트에서 전역 관리자 역할을 하는 사용자로 로그인되었는지 확인합니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **보호** 섹션에서, **ID 보호**를 클릭합니다.

1. **ID 보호 \| 개요** 블레이드에서 **보호**와 **보고**, **알림** 옵션을 검토합니다. 

#### 작업 2: 사용자 위험 정책 구성

이 작업에서는 사용자 위험 정책을 만듭니다. 

1. **ID 보호 \| 개요** 블레이드의 **보호** 섹션에서 **사용자 위험 정책**을 클릭합니다.

1. 다음 설정으로 **사용자 위험 수정 정책**을 구성합니다. 

   - **사용자**를 클릭한 뒤 **사용자** 블레이드의 **포함** 탭에서 **모든 사용자** 옵션이 있는지 확인합니다.

   - **사용자** 블레이드에서 **제외** 탭으로 전환하고 **제외된 사용자 선택**을 클릭한 다음 사용자 계정을 선택하고 **선택을 클릭한 뒤 **완료**를 클릭합니다. 

   - **조건**을 클릭하고 **조건** 블레이드에서 **사용자 위험**을 클릭한 후 **사용자 위험** 블레이드에서 **낮음 이상**을 선택하고 **선택을 클릭한 다음 **완료**를 클릭합니다. 

   - **액세스**를 클릭하고 **액세스** 블레이드에서 **액세스 허용** 옵션과 **암호 변경 필요** 확인란이 선택되었는지 확인하고 **선택**을 클릭합니다.

   - **정책 적용**을 **켬**으로 설정하고 **저장**을 클릭합니다.

#### 작업 3: 로그인 위험 정책 구성

이 작업에서는 로그인 위험 정책을 구성합니다. 

1. **ID 보호 \| 사용자 위험 정책** 블레이드의 **보호** 섹션에서 **로그인 위험 정책**을 클릭합니다.

1. 다음 설정으로 **로그인 위험 수정 정책**을 구성합니다. 

   - **사용자**를 클릭한 뒤 **사용자** 블레이드의 **포함** 탭에서 **모든 사용자** 옵션이 있는지 확인합니다.

   - **조건**을 클릭하고 **조건** 블레이드에서 **사용자 위험**을 클릭한 뒤 **위험** 블레이드에서 **중간 이상**을 선택하고 **선택을 클릭한 다음 **완료**를 클릭합니다. 

   - **액세스**를 클릭하고 **액세스** 블레이드에서 **액세스 허용** 옵션과 **다단계 인증 필요** 확인란이 선택되어 있는지 확인한 뒤 **선택**을 클릭합니다.

   - **정책 적용**을 **켬**으로 설정하고 **저장**을 클릭합니다.

#### 작업 4: Azure AD ID 보호 정책에 대한 위험 이벤트 시뮬레이션 

> 이 작업을 시작하기 전에 연습 0에서 시작한 템플릿 배포가 완료되었는지 확인합니다. 배포에는 **az500-04-vm1**이라는 Azure VM이 포함됩니다. 

1. Azure Portal에서 **디렉터리 + 구독** 필터를 **az500-04-vm1** Azure VM을 배포한 Azure 구독과 연결된 Azure AD 테넌트로 설정합니다.

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에**가상 머신**을 입력하고 **Enter** 키를 누릅니다.

1. **가상 머신** 블레이드에서 **az500-04-vm1** 항목을 클릭합니다. 

1. **az500-04-vm1** 블레이드에서 **연결**을 클릭하고 드롭다운 메뉴에서 **RDP**를 클릭합니다. 

1. **RDP 파일 다운로드**를 클릭한 후 원격 데스크톱을 통해 **az500-04-vm1** Azure VM에 연결합니다. 인증하라는 메시지가 표시되면 다음 자격 증명을 입력합니다.

   |설정|값|
   |---|---|
   |사용자 이름| **학생** |
   |암호| **Pa55w.rd1234** |

    >**참고**: 원격 데스크톱 세션과 **서버 관리자**가 로드될 때까지 기다립니다.  

    >**참고**: 다음 단계는 원격 데스크톱 세션에서 **az500-04-vm1** Azure VM으로 수행됩니다. 

1. **서버 관리자**에서 **로컬 서버**를 클릭한 다음 **IE 보안 강화 구성**을 클릭합니다.

1. **Internet Explorer 강화된 보안 구성** 대화 상자에서 두 옵션을 **해제**로 설정하고 **확인**을 클릭합니다.

1. **Internet Explorer**를 시작하고 드롭다운 메뉴의 도구 모음에서 톱니 바퀴 아이콘을 클릭한 뒤 **안전**을 클릭한 다음 **InPrivate 브라우징**을 클릭합니다.

1. InPrivate Internet Explorer 창에서 [**https://www.torproject.org/projects/torbrowser.html.en**](https://www.torproject.org/projects/torbrowser.html.en)의 ToR 브라우저 프로젝트로 이동합니다.

1. ToR 브라우저의 Windows 버전을 다운로드하고 기본 설정으로 설치합니다. 

1. 설치가 완료되면 ToR 브라우저를 시작하고 초기 페이지에서 **연결** 옵션을 사용하여 [**https://myapps.microsoft.com**](https://myapps.microsoft.com)의 애플리케이션 액세스 패널로 이동합니다.

1. 메시지가 표시되면 **aaduser3** 계정으로 로그인을 시도합니다. 

    >**참고**: **로그인이 차단되었음** 메시지가 표시됩니다. 해당 계정은 ToR 브라우저 사용과 관련한 로그인 위험 증가로 필요해진 다단계 인증으로 구성되지 않을 것입니다.

1. **다른 계정으로 로그아웃 및 로그인 옵션**을 사용하여 해당 랩의 이전 다단계 인증을 위해 만들고 구성한 **aaduser1** 계정으로 로그인합니다.

    >**참고**: 이번에는 **의심스러운 활동이 감지됨** 메시지가 표시됩니다. 이 계정은 다단계 인증으로 구성되었으므로 다시 한번 예상됩니다. ToR 브라우저 사용과 관련한 로그인 위험이 증가하는 것을 고려하여 다단계 인증을 사용해야 합니다.

1. **확인** 옵션을 사용하고 문자 또는 통화를 통해 ID를 확인할지 여부를 지정합니다.

1. 확인을 완료하고 응용 프로그램 액세스 패널에 성공적으로 로그인했는지 확인합니다.

1. RDP 세션을 닫습니다. 

    >**참고**: 이 시점에서 두 개의 서로 다른 로그인을 시도했습니다. 그런 다음 Azure ID 보호 보고서를 검토합니다.

#### 작업 5: Azure AD ID 보호 보고 검토

이 작업에서는 ToR 브라우저 로그인에서 생성된 Azure AD ID 보호 보고서를 검토합니다.

1. Azure Portal로 돌아가서 **디렉터리 + 구독** 필터를 사용하여 **AdatumLab500-04** Azure Active Directory 테넌트로 전환합니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **보고** 섹션에서 **위험한 사용자**를 클릭합니다. 

1. **aaduser3** 사용자 계정 항목을 검토합니다.

1. **보안 \| 시작** 블레이드의 **보고서** 섹션에서 **위험한 로그인**을 클릭합니다. 

1. **aaduser3** 사용자 계정을 통한 로그인에 해당하는 항목을 검토합니다.

1. **보고서**에서 **위험 검색**을 클릭합니다.

1. ToR 브라우저에서 생성된 익명 IP 주소에서 로그인을 나타내는 항목을 검토합니다. 

> 결과: 위험 이벤트를 시뮬레이션하여 Azure AD ID 보호 구성의 유효성을 검사할 뿐만 아니라 Azure AD ID 보호를 사용하고 사용자 위험 정책 및 로그인 위험 정책을 구성했습니다.

**리소스 정리**

> 더 이상 사용하지 않는 새로 만든 Azure 리소스를 제거해야 합니다. 사용하지 않는 리소스를 제거하면 예기치 않은 비용이 발생하지 않습니다. 

다음 단계를 사용하여 **AdatumLab500-04** Azure AD 테넌트의 ID 보호 정책을 사용하지 않도록 설정합니다.

1. Azure Portal에서 다시 **AdatumLab500-04** Azure Active Directory 테넌트 블레이드로 이동합니다.

1. **AdatumLab500-04** 블레이드의 **관리** 섹션에서 **보안**을 클릭합니다.

1. **보안 \| 시작** 블레이드의 **보호** 섹션에서, **ID 보호**를 클릭합니다.

1. **ID 보호 \| 개요** 블레이드에서 **사용자 위험 정책**을 클릭합니다.

1. **ID 보호 \| 사용자 위험 정책** 블레이드에서 **정책 적용**을 **끄기**로 설정한 후 **저장**을 클릭합니다.

1. **ID 보호 \| 사용자 위험 정책** 블레이드에서 **로그인 위험 정책**을 클릭합니다.

1. **ID 보호 \| 로그인 위험 정책** 블레이드에서 **정책 적용**을 **끄기**로 설정한 다음 **저장**을 클릭합니다.

다음 단계를 사용하여 랩의 앞 부분에서 프로비전한 Azure VM을 중지합니다.

1. Azure Portal에서 **디렉터리 + 구독** 필터를 **az500-04-vm1** Azure VM을 배포한 Azure 구독과 연결된 Azure AD 테넌트로 설정합니다.

1. Azure Portal에서 Azure Portal 페이지 상단의 **리소스, 서비스 및 문서 검색** 텍스트 상자에 **가상 머신**을 입력하고 **Enter** 키를 누릅니다.

1. **가상 머신** 블레이드에서 **az500-04-vm1** 항목을 클릭합니다. 
 
1. **az500-04-vm1** 블레이드에서 **중지**를 클릭하고 확인하라는 메시지가 표시되면 **확인**을 클릭하세요. 

>  PIM 랩에 종속성이 있기 때문에 이 랩에서 프로비전된 리소스는 제거하지 않습니다.